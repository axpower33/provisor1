
&НаСервере
Процедура СоздатьНаСервере()
	// Вставить содержимое обработчика.
  /////////////////////////////////////////
   ИмпортНаСервере()
КонецПроцедуры

&НаКлиенте
Процедура СоздатьДокументыИзСS(Команда)
	СоздатьНаСервере();
КонецПроцедуры
&НаСервере
Процедура ИмпортНаСервере()
    
     Соединение = ПолучитьПодключениеКБД();
    
КонецПроцедуры

Функция ПолучитьПодключениеКБД()
    Путь="C:\1C_7.7-8.2 Bases\DemoAccountingEduc";
    БазаДанных = Строка(Путь);
    Юзер = Строка("");
    ПарольЮзеря = Строка("");
    
    ComConnector = ПолучитьCOMОбъектПоВерсииПлатформы();
        
    ПараметрыПодключенияИБ = "File='" + СокрЛП(БазаДанных) + "'; usr='" + СокрЛП(Юзер) + "'; pwd='" + СокрЛП(ПарольЮзеря) + "';";
    
    Попытка
		Сообщить("База подключена");
		ComConnector.Connect(ПараметрыПодключенияИБ);
    Исключение
        Сообщить(ОписаниеОшибки());
        Возврат Неопределено;
	КонецПопытки;
	
	
	Конт2=Справочники.Справочникконтрагентов;
	КонтВыб= ComConnector. Справочники.Контрагенты.Выбрать();
	Пока КонтВыб.Следующий() Цикл
		КонтОб=КонтВыб.ПолучитьОбъект();
		Конт2Об=Конт2.СоздатьЭлемент();
		Конт2Об.Код="К"+Прав(КонтОб.Код,8);
		Конт2Об.Наименование=КонтОб.Наименование;
		Конт2Об.Записать()
	КонецЦикла;	
	
	ЕдИзм2=Справочники.СправочникЕдИзм;
	ЕдИзмВыб= ComConnector. Справочники.ЕдиницыИзмеренияВЕТИС.Выбрать();
	Пока ЕдИзмВыб.Следующий() Цикл
		ЕдИзмОб=ЕдИзмВыб.ПолучитьОбъект();
		ЕдИзм2Об=ЕдИзм2.СоздатьЭлемент();
		ЕдИзм2Об.УстановитьНовыйКод();
		ЕдИзм2Об.Наименование=ЕдИзмОб.Наименование;
		ЕдИзм2Об.Записать()
	КонецЦикла;	
	
	Номен2=Справочники.Справочникноменклатуры;
	НоменВыб= ComConnector. Справочники.Номенклатура.Выбрать();
	Пока НоменВыб.Следующий() Цикл
		НоменОб=НоменВыб.ПолучитьОбъект();
		Номен2Об=Номен2.СоздатьЭлемент();
		Номен2Об.Код="Н"+Прав(НоменОб.Код,10);
		Номен2Об.Наименование=НоменОб.Наименование;
		Номен2Об.Контрагент=Конт2.НайтиПоКоду(НоменОб.Производитель.Код);
		Номен2Об.ЕдИзм=ЕдИзм2.НайтиПоНаименованию(НоменОб.ЕдиницаИзмерения.Наименование,Истина);
		Номен2Об.Записать()
	КонецЦикла;	

	
	Док2=Документы.Приходноменклатуры; 
	ДокВыб = ComConnector. Документы.ПоступлениеТоваровУслуг.Выбрать();
	Пока ДокВыб.Следующий() Цикл
		ДокОб=ДокВыб.ПолучитьОбъект();
		ДокОб2=Док2.СоздатьДокумент();
		
		ДокОб=ДокВыб.ПолучитьОбъект();
		ДокОб2.Номер="Н"+Прав(ДокОб.Номер,10);
		ДокОб2.Дата=ДокОб.Дата;
		ДокОб2.Контрагент=Конт2.НайтиПоКоду(ДокОб.Контрагент.Код);
		Для Каждого Товар Из ДокВыб.Товары Цикл
			СтрТов=ДокОб2.Товары.Добавить();
			СтрТов.Номенклатура=Номен2.НайтиПоНаименованию(Товар.Номенклатура.Наименование,Истина);
			СтрТов.ЕдИзм=ЕдИзм2.НайтиПоНаименованию(Товар.ЕдиницаИзмерения.Наименование,Истина);
			СтрТов.Количество=Товар.Количество;
			СтрТов.Цена=Товар.Цена;
			СтрТов.Сумма=Товар.Сумма;
		КонецЦикла;	
		ДокОб2.Записать();
	КонецЦикла;	
		
        
КонецФункции

Функция ПолучитьCOMОбъектПоВерсииПлатформы() Экспорт
    
    ИмяComОбъекта = "";
    Инфо = Новый СистемнаяИнформация;
    Если СтрНайти(Инфо.ВерсияПриложения, "8.3") > 0 Тогда
        ИмяComОбъекта = "V83.Application";
    ИначеЕсли СтрНайти(Инфо.ВерсияПриложения, "8.2") > 0 Тогда
        ИмяComОбъекта = "V82.Application";
    Иначе
        ВызватьИсключение "Не удалось определить версию платформы";
    КонецЕсли;
    
    COMConnector = Новый COMОбъект(ИмяComОбъекта);
    
    Возврат COMConnector;
    
КонецФункции